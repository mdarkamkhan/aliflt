Module.exports = function(eleventyConfig) {
  
  // 1. Files Copy Karna
  eleventyConfig.addPassthroughCopy("css");
  eleventyConfig.addPassthroughCopy("js");
  eleventyConfig.addPassthroughCopy("uploads"); // Images yahan hoti hain
  eleventyConfig.addPassthroughCopy("admin");
  eleventyConfig.addPassthroughCopy({ "public/": "/" });

  // 2. Collections Banana
  eleventyConfig.addCollection("products",  api => api.getFilteredByGlob("products/*.md"));
  eleventyConfig.addCollection("services",  api => api.getFilteredByGlob("services/*.md"));
  eleventyConfig.addCollection("works",     api => api.getFilteredByGlob("works/*.md"));
  eleventyConfig.addCollection("offers",    api => api.getFilteredByGlob("offers/*.md"));
  // Note: Yahan 'designs' folder se utha rahe hain, lekin tag 'design' ho sakta hai
  eleventyConfig.addCollection("design",   api => api.getFilteredByGlob("designs/*.md"));

  // 3. ðŸ”¥ MAGIC FIX: FORCE URL GENERATION 
  // Yeh code check karega ki file kis folder mein hai aur uska link zabardasti banayega.
  eleventyConfig.addGlobalData("eleventyComputed", {
    permalink: (data) => {
      // Agar file ke andar pehle se permalink set hai (autogenerated nahi), toh wahi use karein
      if (data.permalink && data.permalink !== false) return data.permalink;

      // Agar file "designs" folder mein hai -> /designs/naam/
      if (data.page.filePathStem.startsWith('/designs/')) {
        return "designs/{{ page.fileSlug }}/";
      }

      // Agar file "products" folder mein hai -> /products/naam/
      if (data.page.filePathStem.startsWith('/products/')) {
        return "products/{{ page.fileSlug }}/";
      }

      // Agar file "services" folder mein hai -> /services/naam/
      if (data.page.filePathStem.startsWith('/services/')) {
        return "services/{{ page.fileSlug }}/";
      }

      // Agar file "works" folder mein hai -> /works/naam/
      if (data.page.filePathStem.startsWith('/works/')) {
        return "works/{{ page.fileSlug }}/";
      }

      return data.permalink;
    }
  });

  return {
    dir: { input: "./", includes: "_includes", data: "_data", output: "_site" }
  };
};
