<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALiF Mass Uploader (Mobile)</title>
    <style>
        body { font-family: sans-serif; padding: 15px; background: #f0f2f5; padding-bottom: 80px; }
        h2 { text-align: center; color: #333; margin-top: 0; }
        
        /* CONFIG BOX */
        .config-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .config-row { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
        label { font-size: 12px; font-weight: bold; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
        
        /* PRODUCT CARD */
        .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid #000; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .row-num { font-weight: bold; }
        .btn-del { color: red; font-weight: bold; background: none; border: none; font-size: 20px; }

        /* FLOATING BUTTONS */
        .fab-container { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
        .btn { padding: 12px 20px; border: none; border-radius: 50px; font-weight: bold; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; }
        .btn-add { background: #333; }
        .btn-upload { background: #006400; }
        
        .btn-copy { background: #e6f7ff; color: #0050b3; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; float: right; margin-bottom: 5px;}

        /* LOGS */
        #logs { background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

    <h2>üöÄ Mobile Uploader</h2>
    
    <div class="config-box">
        <div class="config-row">
            <div>
                <label>GitHub Username</label>
                <input type="text" id="owner" placeholder="e.g. alif-tailor">
            </div>
            <div>
                <label>Repo Name</label>
                <input type="text" id="repo" placeholder="e.g. alif-website">
            </div>
        </div>
        <div class="config-row">
            <div>
                <label>Token (Paste Once)</label>
                <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx">
            </div>
            <div>
                <label>Upload To:</label>
                <select id="folder">
                    <option value="products">üõçÔ∏è Products</option>
                    <option value="services">‚úÇÔ∏è Services</option>
                    <option value="works">üëó Works</option>
                    <option value="designs">üé® Designs</option>
                    <option value="offers">üì¢ Banners</option>
                </select>
            </div>
        </div>
    </div>

    <div id="rows-container"></div>

    <div class="fab-container">
        <button class="btn btn-add" onclick="addRow()">+ Add</button>
        <button class="btn btn-upload" onclick="startUpload()">Upload üöÄ</button>
    </div>

    <div id="logs"></div>

    <script>
        const container = document.getElementById('rows-container');
        const logBox = document.getElementById('logs');
        let rowCount = 0;

        // Load saved data
        window.onload = () => {
            document.getElementById('owner').value = localStorage.getItem('gh_owner') || '';
            document.getElementById('repo').value = localStorage.getItem('gh_repo') || '';
            document.getElementById('token').value = localStorage.getItem('gh_token') || '';
            addRow();
        };

        function log(msg) {
            logBox.style.display = 'block';
            logBox.innerHTML += `<div>> ${msg}</div>`;
        }

        function addRow() {
            rowCount++;
            const div = document.createElement('div');
            div.className = 'card';
            const isFirst = rowCount === 1;
            
            div.innerHTML = `
                <div class="card-header">
                    <span class="row-num">Item #${rowCount}</span>
                    <button class="btn-del" onclick="this.parentElement.parentElement.remove()">√ó</button>
                </div>
                
                <label>Title *</label>
                <input type="text" class="inp-title" placeholder="Item Name">
                
                <label style="margin-top:10px; display:block;">Image Filename</label>
                <input type="text" class="inp-img" placeholder="e.g. photo.jpg">

                ${isFirst ? '<button class="btn-copy" onclick="copyAll(\'inp-price\')">‚¨á Copy Price</button>' : ''}
                <label style="margin-top:10px; display:block;">Price</label>
                <input type="number" class="inp-price" placeholder="0">

                ${isFirst ? '<button class="btn-copy" onclick="copyAll(\'inp-cat\')">‚¨á Copy Cat</button>' : ''}
                <label style="margin-top:10px; display:block;">Category</label>
                <input type="text" class="inp-cat" placeholder="Category">

                ${isFirst ? '<button class="btn-copy" onclick="copyAll(\'inp-desc\')">‚¨á Copy Desc</button>' : ''}
                <label style="margin-top:10px; display:block;">Description</label>
                <textarea class="inp-desc" rows="2" placeholder="Details"></textarea>
            `;
            container.appendChild(div);
            window.scrollTo(0, document.body.scrollHeight);
        }

        function copyAll(cls) {
            const val = document.querySelector(`.${cls}`).value;
            document.querySelectorAll(`.${cls}`).forEach(el => el.value = val);
        }

        async function startUpload() {
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const token = document.getElementById('token').value.trim();
            const folder = document.getElementById('folder').value;

            if(!owner || !repo || !token) return alert("Fill GitHub Details first!");

            localStorage.setItem('gh_owner', owner);
            localStorage.setItem('gh_repo', repo);
            localStorage.setItem('gh_token', token);

            const rows = document.querySelectorAll('.card');
            log("Starting upload...");

            for (const row of rows) {
                const getVal = (c) => row.querySelector(`.${c}`)?.value || "";
                const title = getVal('inp-title');
                
                if(!title) continue;

                const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-|-$/g, "");
                const date = new Date().toISOString();
                
                // Determine Layout
                let layout = "product.liquid";
                if(folder === 'designs') layout = "design.liquid";
                if(folder === 'services' || folder === 'works') layout = "service.liquid";

                let content = `---
title: "${title}"
date: "${date}"
layout: "${layout}"
tags: "${folder === 'offers' ? 'offer' : folder.slice(0, -1)}"
image: "/uploads/${getVal('inp-img')}"
price: ${getVal('inp-price') || 0}
category: "${getVal('inp-cat')}"
description: "${getVal('inp-desc')}"
permalink: false
---`;

                const contentEncoded = btoa(unescape(encodeURIComponent(content)));
                const url = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}/${slug}.md`;

                try {
                    // Check if exists
                    let sha = null;
                    try {
                        const check = await fetch(url, { headers: { Authorization: `token ${token}` } });
                        if(check.ok) sha = (await check.json()).sha;
                    } catch(e) {}

                    const body = { message: `Added ${title}`, content: contentEncoded };
                    if(sha) body.sha = sha;

                    const res = await fetch(url, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });

                    if(res.ok) {
                        log(`‚úÖ Uploaded: ${title}`);
                        row.style.borderLeft = "5px solid green";
                    } else {
                        const err = await res.json();
                        log(`‚ùå Error ${title}: ${err.message}`);
                        row.style.borderLeft = "5px solid red";
                    }
                } catch(err) {
                    log(`‚ùå Network Error`);
                }
            }
            alert("Done! Check logs at bottom.");
        }
    </script>
</body>
</html>
