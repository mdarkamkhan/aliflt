<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ALiF Admin App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
      /* --- 1. RESET & BASE --- */
      body { margin: 0; background: #eff3f6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
      
      /* --- 2. ðŸ”´ NUCLEAR OPTION: HIDE THAT SIDEBAR --- */
      @media (max-width: 768px) {
        
        /* This selects ANY element that looks like a sidebar or collection menu */
        .nc-app-sidebar, 
        .nc-sidebar, 
        aside, 
        div[class*="Sidebar"], 
        div[class*="CollectionPage-sidebar"],
        nav[aria-label="Collections"] {
            display: none !important; 
            visibility: hidden !important;
            width: 0 !important;
            height: 0 !important;
            opacity: 0 !important;
            pointer-events: none !important;
            position: absolute !important;
            top: -9999px !important;
        }
        
        /* Expand the main content to fill the empty space */
        .nc-app-main { 
            width: 100% !important; 
            margin-left: 0 !important; 
            padding-bottom: 80px !important; /* Space for bottom nav */
        }
        
        /* Fix the header */
        .nc-app-header { position: sticky !important; top: 0; z-index: 500; }
        
        /* --- CARD STYLE LIST (Makes items look like Apps) --- */
        .nc-collectionPage-list {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important; 
            gap: 10px !important;
            padding: 10px !important;
        }
        
        a.nc-collectionPage-entry {
            background: white !important;
            border-radius: 12px !important;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05) !important;
            border: none !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
            height: auto !important;
            min-height: 150px !important;
        }

        /* Clean up the text inside cards */
        .nc-collectionPage-entry-detail { display: none !important; }
        .nc-collectionPage-entry-title { font-size: 13px !important; font-weight: 600 !important; padding: 10px !important; }
      }

      /* --- 3. BOTTOM NAVIGATION BAR (APP STYLE) --- */
      .mobile-nav {
        display: none; /* Hidden on Desktop */
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: white; border-top: 1px solid #eee;
        height: 65px; justify-content: space-around; align-items: center;
        z-index: 9999; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        padding-bottom: env(safe-area-inset-bottom);
      }
      
      @media (max-width: 768px) { .mobile-nav { display: flex; } }

      .nav-item {
        display: flex; flex-direction: column; align-items: center;
        text-decoration: none; color: #888; font-size: 11px; flex: 1;
        padding: 8px 0; cursor: pointer; -webkit-tap-highlight-color: transparent;
      }
      
      .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: currentColor; }
      .nav-item.active { color: #0f62fe; font-weight: 700; }

      /* --- 4. FLOATING ACTION BUTTON (MASS UPLOAD) --- */
      #massUploadBtn {
        position: fixed; bottom: 85px; right: 20px;
        background: #0f62fe; color: white; border: none;
        width: 56px; height: 56px; border-radius: 50%;
        box-shadow: 0 4px 15px rgba(15, 98, 254, 0.4); cursor: pointer;
        z-index: 9998; display: flex; align-items: center; justify-content: center;
        font-size: 24px; transition: transform 0.2s;
      }
      #massUploadBtn:active { transform: scale(0.9); }
      
      /* --- 5. MODAL STYLES --- */
      #massUploadModal {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); z-index: 10000; align-items: flex-end;
      }
      .modal-content {
        background: #fff; padding: 24px; border-radius: 20px 20px 0 0; width: 100%; 
        box-sizing: border-box; animation: slideUp 0.3s ease-out;
        padding-bottom: calc(24px + env(safe-area-inset-bottom));
      }
      @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
      
      .modal-content select, .modal-content input {
        width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #eee; border-radius: 10px; background: #f9f9f9; font-size: 16px;
      }
    </style>
  </head>

  <body>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <div class="mobile-nav">
      <div class="nav-item active" onclick="navigateTo('products', this)">
        <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V6h16v12zM6 10h2v2H6zm0 4h2v2H6zm4-4h6v2h-6zm0 4h6v2h-6z"/></svg>
        Products
      </div>
      
      <div class="nav-item" onclick="navigateTo('services', this)">
        <svg viewBox="0 0 24 24"><path d="M20.41 4.94l-1.35-1.35c-.78-.78-2.05-.78-2.83 0L13.4 6.41 3 16.82V21h4.18l10.46-10.46 2.77-2.77c.79-.78.79-2.05 0-2.83zm-14 14.12L5 19v-1.36l9.82-9.82 1.41 1.41-9.82 9.83z"/></svg>
        Services
      </div>
      
      <div class="nav-item" onclick="navigateTo('designs', this)">
         <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.22-7.52-4.28z"/></svg>
        Designs
      </div>
      
      <div class="nav-item" onclick="navigateTo('works', this)">
        <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM8 15c0-1.66 1.34-3 3-3 .35 0 .69.07 1 .18V6h5v2h-3v7.03c-.02 1.64-1.35 2.97-3 2.97-1.66 0-3-1.34-3-3z"/></svg>
        Works
      </div>
    </div>

    <button id="massUploadBtn">ðŸ“‚</button>

    <div id="massUploadModal">
      <div class="modal-content">
        <h3 style="margin-top:0; font-size: 20px;">Mass Upload</h3>
        <p style="color:#666; font-size:14px; margin-bottom: 20px;">Upload CSV to add items.</p>
        
        <label style="font-size:12px; font-weight:bold; color:#555;">Collection:</label>
        <select id="massCollection">
          <option value="products">Products</option>
          <option value="services">Services</option>
          <option value="designs">Designs</option>
          <option value="works">Works</option>
        </select>

        <label style="font-size:12px; font-weight:bold; color:#555;">CSV File:</label>
        <input type="file" id="massFile" accept=".csv" />
        
        <button id="massConfirm" style="width:100%; padding:15px; background:#0f62fe; color:white; font-weight:bold; border:none; border-radius:12px; font-size:16px; margin-top: 10px;">Start Upload</button>
        <button id="closeMassModal" style="width:100%; padding:15px; background:transparent; color:#888; border:none; margin-top:5px;">Cancel</button>
        <p id="massUploadStatus" style="margin-top:10px; font-size:14px; font-weight:bold; text-align:center;"></p>
      </div>
    </div>

    <script>
      function navigateTo(collection, el) {
        window.location.hash = `#/collections/${collection}`;
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
      }

      document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById("massUploadBtn");
        const modal = document.getElementById("massUploadModal");
        const closeBtn = document.getElementById("closeMassModal");
        const confirmBtn = document.getElementById("massConfirm");
        const status = document.getElementById("massUploadStatus");

        btn.addEventListener("click", () => modal.style.display = "flex");
        closeBtn.addEventListener("click", () => modal.style.display = "none");

        confirmBtn.addEventListener("click", () => {
          const collection = document.getElementById("massCollection").value;
          const file = document.getElementById("massFile").files[0];

          if (!file) return alert("Please select a CSV file!");
          status.textContent = "â³ Reading file...";
          status.style.color = "#007bff";

          const reader = new FileReader();
          reader.onload = async (e) => {
            const text = e.target.result;
            const rows = text.split("\n").map(row => row.trim()).filter(row => row.length > 0);
            
            if (rows.length < 2) return alert("CSV file is empty or invalid.");

            const headers = rows[0].split(",").map(h => h.trim());
            const totalItems = rows.length - 1;
            status.textContent = `ðŸš€ Uploading ${totalItems} items...`;

            const backend = window.CMS.getBackend();
            let successCount = 0;

            for (let i = 1; i < rows.length; i++) {
              const values = rows[i].split(",");
              let entryObj = {};
              headers.forEach((header, index) => {
                entryObj[header] = values[index] ? values[index].trim() : "";
              });

              const title = entryObj.title || "Untitled " + Date.now();
              const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-|-$/g, "");

              let fileContent = "---\n";
              for (const key in entryObj) {
                if (key !== 'description' && key !== 'body') {
                   const val = entryObj[key];
                   if (!isNaN(val) && val !== "" && key !== 'title') {
                      fileContent += `${key}: ${val}\n`;
                   } else {
                      fileContent += `${key}: "${val}"\n`;
                   }
                }
              }
              fileContent += `date: "${new Date().toISOString()}"\n`;
              fileContent += "---\n";
              if (entryObj.description) fileContent += entryObj.description;

              try {
                await backend.persistEntry({
                  collection: collection,
                  slug: slug,
                  entry: { path: `${collection}/${slug}.md`, raw: fileContent }
                });
                successCount++;
                status.textContent = `âœ… Uploaded ${successCount} / ${totalItems}`;
              } catch (err) {
                console.error(err);
                status.textContent = `âŒ Error on item ${i}`;
              }
            }
            status.textContent = "ðŸŽ‰ Done! Refreshing...";
            status.style.color = "green";
            setTimeout(() => location.reload(), 1500);
          };
          reader.readAsText(file);
        });
      });
    </script>
  </body>
</html>
