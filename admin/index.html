<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Content Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ‚úÖ Mobile-friendly + readable design -->
    <style>
      body {
        margin: 0;
        font-family: "Inter", system-ui, sans-serif;
        background: #f9fafb;
      }

      .nc-app, .nc-collectionPage, .cms-editor {
        width: 100% !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
      }

      /* Sidebar responsive */
      .nc-sidebar {
        position: relative !important;
        width: 100% !important;
        height: auto !important;
        display: flex !important;
        flex-wrap: wrap !important;
        justify-content: space-around;
        background: #fff;
        border-bottom: 1px solid #ddd;
        z-index: 1000;
      }

      .nc-sidebar a, .nc-sidebar button {
        flex: 1;
        text-align: center;
        padding: 12px 5px;
        font-size: 15px;
        border-radius: 8px;
      }

      .nc-collection {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)) !important;
        gap: 14px !important;
        padding: 14px !important;
      }

      .nc-entryCard {
        border-radius: 12px !important;
        overflow: hidden !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      }

      .nc-button, button {
        padding: 10px 16px !important;
        border-radius: 8px !important;
        font-size: 15px !important;
      }

      .nc-previewPane {
        display: none !important;
      }

      @media (min-width: 768px) {
        .nc-previewPane {
          display: block !important;
        }
      }

      .nc-header {
        flex-wrap: wrap;
        justify-content: center !important;
        padding: 6px !important;
        background: #fff;
        border-bottom: 1px solid #e0e0e0;
      }

      .nc-entryEditor, .nc-entryPage {
        padding: 12px !important;
      }

      /* Bottom nav */
      .mobile-bottom-nav {
        display: flex;
        justify-content: space-around;
        background: #fff;
        border-top: 1px solid #ccc;
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 60px;
        align-items: center;
        z-index: 10000;
      }

      .mobile-bottom-nav button {
        background: none;
        border: none;
        font-size: 15px;
        color: #333;
        flex: 1;
      }

      .mobile-bottom-nav button.active {
        color: #007bff;
        font-weight: 600;
      }

      .nc-collectionPage {
        margin-bottom: 70px;
      }

      /* Modal style */
      #massUploadModal h3 {
        font-size: 18px;
      }
    </style>
  </head>

  <body>
    <!-- Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <!-- Netlify invite redirect -->
    <script>
      (function() {
        if (document.location.hash.indexOf('invite_token') > -1) {
          document.location.pathname = '/admin/';
        }
      })();
    </script>

    <!-- ‚úÖ Bottom mobile navigation -->
    <div class="mobile-bottom-nav">
      <button onclick="location.hash='#/collections/offers'">Offers</button>
      <button onclick="location.hash='#/collections/products'">Products</button>
      <button onclick="location.hash='#/collections/services'">Services</button>
      <button onclick="location.hash='#/collections/works'">Works</button>
    </div>

    <!-- ‚úÖ Mass Upload Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const checkHeader = setInterval(() => {
    // ‚úÖ Try multiple possible selectors
    const headerActions =
      document.querySelector(".nc-appHeader-actions") ||
      document.querySelector(".nc-app-header-actions") ||
      document.querySelector('[class*="HeaderActions"]') ||
      document.querySelector('[data-testid="app-header-actions"]') ||
      document.querySelector("header button")?.parentElement;

    // Wait until CMS header is rendered
    if (headerActions && !document.querySelector("#massUploadBtn")) {
      clearInterval(checkHeader);

      // ‚úÖ Create button
      const btn = document.createElement("button");
      btn.id = "massUploadBtn";
      btn.textContent = "üì¶ Mass Upload";
      btn.style.marginLeft = "10px";
      btn.style.padding = "10px 14px";
      btn.style.borderRadius = "8px";
      btn.style.border = "none";
      btn.style.background = "#007bff";
      btn.style.color = "#fff";
      btn.style.cursor = "pointer";
      btn.style.fontSize = "15px";
      headerActions.appendChild(btn);

      // ‚úÖ Modal HTML
      const modal = document.createElement("div");
      modal.id = "massUploadModal";
      modal.style.display = "none";
      modal.style.position = "fixed";
      modal.style.top = "0";
      modal.style.left = "0";
      modal.style.width = "100%";
      modal.style.height = "100%";
      modal.style.background = "rgba(0,0,0,0.5)";
      modal.style.zIndex = "9999";
      modal.innerHTML = `
        <div style="
          background: #fff;
          padding: 20px;
          border-radius: 12px;
          width: 90%;
          max-width: 420px;
          margin: 12% auto;
          text-align: center;
        ">
          <h3>üì¶ Mass Upload Entries</h3>
          <p>Select a collection and upload CSV/JSON file.</p>
          <select id="massCollection" style="padding: 10px; width: 100%; border-radius: 6px; margin-bottom: 10px;">
            <option value="products">Products</option>
            <option value="services">Services</option>
            <option value="works">Works</option>
          </select>
          <input type="file" id="massFile" accept=".csv,.json" style="margin-bottom: 10px; width: 100%;" />
          <button id="massConfirm" style="padding: 10px 16px; background: #28a745; color: #fff; border: none; border-radius: 6px;">Upload All</button>
          <p id="massUploadStatus" style="margin-top: 10px; color: #333;"></p>
          <button id="closeMassModal" style="margin-top: 10px; background: #ccc; border: none; padding: 8px 12px; border-radius: 6px;">Cancel</button>
        </div>
      `;
      document.body.appendChild(modal);

      // ‚úÖ Event bindings
      btn.addEventListener("click", () => (modal.style.display = "block"));
      document.getElementById("closeMassModal").addEventListener("click", () => (modal.style.display = "none"));

      document.getElementById("massConfirm").addEventListener("click", async () => {
        const collection = document.getElementById("massCollection").value;
        const file = document.getElementById("massFile").files[0];
        const status = document.getElementById("massUploadStatus");

        if (!file) return alert("Please select a file first!");

        status.textContent = "‚è≥ Uploading...";

        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const text = e.target.result;
            let entries = [];

            if (file.name.endsWith(".csv")) {
              const [header, ...rows] = text.split("\n").filter(Boolean);
              const headers = header.split(",");
              entries = rows.map((r) => {
                const values = r.split(",");
                const obj = {};
                headers.forEach((h, i) => (obj[h.trim()] = values[i]?.trim()));
                return obj;
              });
            } else {
              entries = JSON.parse(text);
            }

            const backend = window.CMS?.getBackend();
            if (!backend) throw new Error("Backend not ready");

            for (const entry of entries) {
              const slug = entry.title?.toLowerCase().replace(/\s+/g, "-") || Date.now();
              const content = `---\ntitle: "${entry.title || "Untitled"}"\ndate: "${new Date().toISOString()}"\nprice: ${entry.price || 0}\ncategory: "${entry.category || ""}"\nimage: "${entry.image || ""}"\n---\n${entry.description || ""}`;
              await backend.persistEntry({
                collection,
                slug,
                entry: { path: `${collection}/${slug}.md`, raw: content }
              });
            }

            status.textContent = "‚úÖ Upload successful!";
            setTimeout(() => location.reload(), 1500);
          } catch (err) {
            status.textContent = "‚ùå Error: " + err.message;
          }
        };
        reader.readAsText(file);
      });
    }
  }, 1500);
});
                </script>
